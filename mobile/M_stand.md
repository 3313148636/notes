

### 移动M站开发

#### 第一部分 - 移动端布局

常用的布局方式有如下几种方式：

* 固定布局               量的设计图上的尺寸直接设置，一般是pc端， 设计图也只有一张 （ 992 - 1200 ）
* 流式布局（自适应布局）  根据设备尺寸调整内容的宽度，一般是移动端，  设计图也只有一张 
* 响应式布局            根据设备尺寸不同来调整内容的比例宽度/高度/排列方式/显示隐藏 ，设计图至少有两张

注意，目前，pc用固定的多，移动端大部分是流式布局，但是都不是完全如此



##### viewport

我们在进行移动端布局的时候其实通常需要在页面中头部里设置一个meta标签如下：

<meta name = "viewport" content="width=device-width,...."/>

其实就是利用meta标签对viewport进行了一次设置，那么什么是viewport呢？？？

viewport我们把它叫做视口，大家需要明白的是：页面不是直接放在浏览器中的，先放在viewport视口中，然后再将viewport按照比例缩放到浏览器中。

线索：

1. 发现在不设置viewport的时候，元素宽度为375，放入到375的手机中却缩小了。

2. body的宽度为980px，并不是容器的宽度375

其实是这样的：

页面是放在viewport中的，这个时候页面的宽度其实就是viewport的宽度，此时，viewport宽度为980，所有页面宽度也是980，然后viewport会缩放后放入浏览器中，此时我们看到的页面就是缩小的。

如何处理这个问题呢？

这个问题的关键其实是因为viewport的宽度和浏览器宽度不一致导致的，解决问题的方法就是处理viewport的宽度。


viewport的宽度是怎么变化的，难道一直都是980吗？

当浏览器的宽度>980的时候，viewport的宽度 = 浏览器的宽度，浏览器宽度<=980的时候，viewport的宽度 = 980；

在PC端中viewport永远都 = 浏览器的宽度。



正因为viewport的宽度与浏览器的宽度不一致，所以在进行移动端布局的时候需要利用meta标签对viewport进行设置：

<meta name=”viewport” content=”width=240, height=320, user-scalable=yes, initial-scale=2.5, maximum-scale=5.0, minimun-scale=1.0”>

width 可以设置 viewport的宽度， n / 'device-width'
initial-scale 初始化缩放比例   1
maximum-scale 最大缩放比       1
minimun-scale 最小缩放比       1
user-scalable 用户是否可以缩放  no/yes

其实meta标签的作用很多，比如提高SEO优化等级/控制不同的浏览器做一些不同的事情。。。


##### retina and dpr

移动端屏幕和PC端的屏幕是不一样的，移动端屏幕是视网膜高清屏（Retina）

retina屏幕的特点其实就是像素小。描述屏幕的清晰程度有一个参数：设备像素缩放比（DPR）

DPR = 物理像素 / 逻辑像素。

例如，iphone手机参数640宽度，我们在布局开发的时候，知道其实它的宽度是320，640就是物理像素，320是逻辑像素

所以iphone5的dpr是 2 ，而pc的dpr都是1

也是说，此时，在iphone5 中会使用4个像素点来渲染PC端中1个像素点渲染的内容。

不管什么设备，我们的逻辑像素大小都是不变的，而不同dpr的设备它的物理像素大小是不一样的，dpr越大，物理像素越小，也是说同样逻辑大小的屏幕，会使用越多的物理像素去渲染，越高清。

一般情况下，我们不需要考虑这个dpr的情况，针对图片的时候就需要做处理了：

因为图片等是位图（放大会失真），所以1px*1px（逻辑）的图片放在pc端中正好使用1*1个物理像素渲染，不失真，但是1*1逻辑像素的图片放在dpr为2的设备中，会使用2*2个物理像素去渲染，所以就会失真。

为了避免图片在retina屏幕中失真，我们会使用2倍或者3倍的图片，而在pc中因为dpr一般为1，所以只使用1倍图片。

所以，移动端中设计图一般都是2倍的！

除了图片的设置，还有一个需要处理的就是1px 边框

当我们 在移动端中设置某个元素的边框为1px的时候，其实在设备中看到是2px- 粗的，所以需要使用伪类元素模拟边框后，利用css3中transform的scale在对应方向进行缩放就ok
```
.demo::after {
    content: '';
    display: block;
    width: 100%;
    height: 1px;
    background: #333;
    position: absolute;
    left: 0;bottom: 0px;
    transform: scale(1, 0.5);
}
```
##### 设计图尺寸

移动端的设计图尺寸一般都是多大的呢？

因为移动端设备的尺寸都是不一样的，难道设计师会为了每一款尺寸的设备都去出一张设计图吗？

实际上移动端设计师只会根据某一个尺寸出一张设计图，然后工程师利用一些自适应布局的技术实现在不同尺寸的设备中表现一致。

设计师一般会按照iphone6/7/8的尺寸来设计，所以移动端的设计图尺寸一般为 750，在以前都是640的。

##### 布局单位

因为设计师只出一个尺寸的设计图，所以我们必须根据该尺寸的图来实现不同尺寸设备表现一致，所以我们会使用自适应布局，使用的布局单位也就和固定布局不一样了。

常用的布局单位：

1. % 百分比是根据父元素宽度设计的.
2. vw vh vw = 视口宽度 / 100， vh = 视口高度 / 100 ， vmax，vmin, 兼容性不太好
3. rem   rem = html标签的font-size ，其实rem是一个固定单位，但是我们可以利用一些技术，将其处理成一个自适应单位.

##### rem的使用

rem的设置方式有很多种，我们在这里就说明几种。

1. 我们可以将rem设置为屏幕的1/n，例如1/10

2. 如果，设计师给我们的图是640的，我们假设世界上只有这一款手机iphone5s,当我们量的640的设计图种一个元素的宽度为320的话，我们知道，它的宽度应该是160px，我们将html的字体大小也就是rem设置成100px之后，我们元素的宽度就可以写成1.6rem了，大家知道，我们的手机并不只有iphone5这一种，我们就可以算得一个比例:

    640 / 100 = 设计图为x的时候 / rem设置为y， y = x / 6.4
    
    document.documentElement.style.fontSize = document.documentElement.clientWidth  / 3.2 + 'px';
    
3. 也可以操控viewport缩放比例来完成rem的设置。例如饿了么

在这里我们希望大家使用[手淘团队提供的flexible工具进行rem的设置](https://github.com/amfe/article/issues/17?utm_source=caibaojian.com)

flexible会根据dpr来调整viewport，比如dpr为2的，viewport的缩放比例为0.5，这样的话，比如，设计图为750，viewport也为750，页面也是750，不需要处以2，然后将rem设置为viewport宽度的1/10了，所以我们的算法就更简单

如果 750的设计图上有一个元素为75px，此时，viewport宽度为750，页面宽度也为750，rem是750/10 = 75，所以这个元素宽度就可以直接设置为1rem了。

作业：[饿了么首页](https://h5.ele.me/msite/)

### 移动端调试

1. 利用chrome浏览器的移动端模拟器

2. 真机测试 

    ios 7.0    Android  4.4

    UC / 微信内置 / safari/ andriod / qq / 百度浏览器 / chrome / firefox

    vivo  oppo

    让电脑和手机处于同一个局域网,然后再电脑上开启本地服务器，然后利用手机访问该服务器的页面就可以了


